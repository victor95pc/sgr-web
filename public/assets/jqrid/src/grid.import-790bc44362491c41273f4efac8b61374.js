!function(e){"use strict";e.jgrid.extend({jqGridImport:function(t){return t=e.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},t||{}),this.each(function(){var r=this,i=function(t,i){var o,s,n,a=e(i.xmlGrid.config,t)[0],l=e(i.xmlGrid.data,t)[0];if(xmlJsonClass.xml2json&&e.jgrid.parse){o=xmlJsonClass.xml2json(a," "),o=e.jgrid.parse(o);for(n in o)o.hasOwnProperty(n)&&(s=o[n]);if(l){var p=o.grid.datatype;o.grid.datatype="xmlstring",o.grid.datastr=t,e(r).jqGrid(s).jqGrid("setGridParam",{datatype:p})}else e(r).jqGrid(s);o=null,s=null}else alert("xml2json or parse are not present")},o=function(t,i){if(t&&"string"==typeof t){var o=!1;e.jgrid.useJSON&&(e.jgrid.useJSON=!1,o=!0);var s=e.jgrid.parse(t);o&&(e.jgrid.useJSON=!0);var n=s[i.jsonGrid.config],a=s[i.jsonGrid.data];if(a){var l=n.datatype;n.datatype="jsonstring",n.datastr=a,e(r).jqGrid(n).jqGrid("setGridParam",{datatype:l})}else e(r).jqGrid(n)}};switch(t.imptype){case"xml":e.ajax(e.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"xml",complete:function(o,s){"success"===s&&(i(o.responseXML,t),e(r).triggerHandler("jqGridImportComplete",[o,t]),e.isFunction(t.importComplete)&&t.importComplete(o)),o=null}},t.ajaxOptions));break;case"xmlstring":if(t.impstring&&"string"==typeof t.impstring){var s=e.parseXML(t.impstring);s&&(i(s,t),e(r).triggerHandler("jqGridImportComplete",[s,t]),e.isFunction(t.importComplete)&&t.importComplete(s),t.impstring=null),s=null}break;case"json":e.ajax(e.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"json",complete:function(i){try{o(i.responseText,t),e(r).triggerHandler("jqGridImportComplete",[i,t]),e.isFunction(t.importComplete)&&t.importComplete(i)}catch(s){}i=null}},t.ajaxOptions));break;case"jsonstring":t.impstring&&"string"==typeof t.impstring&&(o(t.impstring,t),e(r).triggerHandler("jqGridImportComplete",[t.impstring,t]),e.isFunction(t.importComplete)&&t.importComplete(t.impstring),t.impstring=null)}})},jqGridExport:function(t){t=e.extend({exptype:"xmlstring",root:"grid",ident:"	"},t||{});var r=null;return this.each(function(){if(this.grid){var i,o=e.extend(!0,{},e(this).jqGrid("getGridParam"));if(o.rownumbers&&(o.colNames.splice(0,1),o.colModel.splice(0,1)),o.multiselect&&(o.colNames.splice(0,1),o.colModel.splice(0,1)),o.subGrid&&(o.colNames.splice(0,1),o.colModel.splice(0,1)),o.knv=null,o.treeGrid)for(i in o.treeReader)o.treeReader.hasOwnProperty(i)&&(o.colNames.splice(o.colNames.length-1),o.colModel.splice(o.colModel.length-1));switch(t.exptype){case"xmlstring":r="<"+t.root+">"+xmlJsonClass.json2xml(o,t.ident)+"</"+t.root+">";break;case"jsonstring":r="{"+xmlJsonClass.toJson(o,t.root,t.ident,!1)+"}",void 0!==o.postData.filters&&(r=r.replace(/filters":"/,'filters":'),r=r.replace(/}]}"/,"}]}"))}}}),r},excelExport:function(t){return t=e.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},t||{}),this.each(function(){if(this.grid){var r;if("remote"===t.exptype){var i=e.extend({},this.p.postData);i[t.oper]=t.tag;var o=jQuery.param(i);r=-1!==t.url.indexOf("?")?t.url+"&"+o:t.url+"?"+o,window.location=r}}})}})}(jQuery);