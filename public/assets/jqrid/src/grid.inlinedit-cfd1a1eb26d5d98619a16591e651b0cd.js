!function(e){"use strict";e.jgrid.inlineEdit=e.jgrid.inlineEdit||{},e.jgrid.extend({editRow:function(i,t,r,a,d,n,o,s,l){var c={},u=e.makeArray(arguments).slice(1);return"object"===e.type(u[0])?c=u[0]:(void 0!==t&&(c.keys=t),e.isFunction(r)&&(c.oneditfunc=r),e.isFunction(a)&&(c.successfunc=a),void 0!==d&&(c.url=d),void 0!==n&&(c.extraparam=n),e.isFunction(o)&&(c.aftersavefunc=o),e.isFunction(s)&&(c.errorfunc=s),e.isFunction(l)&&(c.afterrestorefunc=l)),c=e.extend(!0,{keys:!1,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST"},e.jgrid.inlineEdit,c),this.each(function(){var t,r,a,d,n,o=this,s=0,l=null,u={};o.grid&&(d=e(o).jqGrid("getInd",i,!0),d!==!1&&(a=e(d).attr("editable")||"0","0"!==a||e(d).hasClass("not-editable-row")||(n=o.p.colModel,e('td[role="gridcell"]',d).each(function(a){t=n[a].name;var d=o.p.treeGrid===!0&&t===o.p.ExpandColumn;if(d)r=e("span:first",this).html();else try{r=e.unformat.call(o,this,{rowId:i,colModel:n[a]},a)}catch(c){r=n[a].edittype&&"textarea"===n[a].edittype?e(this).text():e(this).html()}if("cb"!==t&&"subgrid"!==t&&"rn"!==t&&(o.p.autoencode&&(r=e.jgrid.htmlDecode(r)),u[t]=r,n[a].editable===!0)){null===l&&(l=a),d?e("span:first",this).html(""):e(this).html("");var p=e.extend({},n[a].editoptions||{},{id:i+"_"+t,name:t});n[a].edittype||(n[a].edittype="text"),("&nbsp;"===r||"&#160;"===r||1===r.length&&160===r.charCodeAt(0))&&(r="");var f=e.jgrid.createEl.call(o,n[a].edittype,p,r,!0,e.extend({},e.jgrid.ajaxOptions,o.p.ajaxSelectOptions||{}));e(f).addClass("editable"),d?e("span:first",this).append(f):e(this).append(f),e.jgrid.bindEv.call(o,f,p),"select"===n[a].edittype&&void 0!==n[a].editoptions&&n[a].editoptions.multiple===!0&&void 0===n[a].editoptions.dataUrl&&e.jgrid.msie&&e(f).width(e(f).width()),s++}}),s>0&&(u.id=i,o.p.savedRow.push(u),e(d).attr("editable","1"),e("td:eq("+l+") input",d).focus(),c.keys===!0&&e(d).bind("keydown",function(t){if(27===t.keyCode){if(e(o).jqGrid("restoreRow",i,c.afterrestorefunc),o.p._inlinenav)try{e(o).jqGrid("showAddEditButtons")}catch(r){}return!1}if(13===t.keyCode){var a=t.target;if("TEXTAREA"===a.tagName)return!0;if(e(o).jqGrid("saveRow",i,c)&&o.p._inlinenav)try{e(o).jqGrid("showAddEditButtons")}catch(d){}return!1}}),e(o).triggerHandler("jqGridInlineEditRow",[i,c]),e.isFunction(c.oneditfunc)&&c.oneditfunc.call(o,i)))))})},saveRow:function(i,t,r,a,d,n,o){var s=e.makeArray(arguments).slice(1),l={};"object"===e.type(s[0])?l=s[0]:(e.isFunction(t)&&(l.successfunc=t),void 0!==r&&(l.url=r),void 0!==a&&(l.extraparam=a),e.isFunction(d)&&(l.aftersavefunc=d),e.isFunction(n)&&(l.errorfunc=n),e.isFunction(o)&&(l.afterrestorefunc=o)),l=e.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST"},e.jgrid.inlineEdit,l);var c,u,p,f,j,g=!1,v=this[0],m={},w={},h={};if(!v.grid)return g;if(j=e(v).jqGrid("getInd",i,!0),j===!1)return g;if(u=e(j).attr("editable"),l.url=l.url||v.p.editurl,"1"===u){var b;if(e('td[role="gridcell"]',j).each(function(i){if(b=v.p.colModel[i],c=b.name,"cb"!==c&&"subgrid"!==c&&b.editable===!0&&"rn"!==c&&!e(this).hasClass("not-editable-cell")){switch(b.edittype){case"checkbox":var t=["Yes","No"];b.editoptions&&(t=b.editoptions.value.split(":")),m[c]=e("input",this).is(":checked")?t[0]:t[1];break;case"text":case"password":case"textarea":case"button":m[c]=e("input, textarea",this).val();break;case"select":if(b.editoptions.multiple){var r=e("select",this),a=[];m[c]=e(r).val(),m[c]=m[c]?m[c].join(","):"",e("select option:selected",this).each(function(i,t){a[i]=e(t).text()}),w[c]=a.join(",")}else m[c]=e("select option:selected",this).val(),w[c]=e("select option:selected",this).text();b.formatter&&"select"===b.formatter&&(w={});break;case"custom":try{if(!b.editoptions||!e.isFunction(b.editoptions.custom_value))throw"e1";if(m[c]=b.editoptions.custom_value.call(v,e(".customelement",this),"get"),void 0===m[c])throw"e2"}catch(d){"e1"===d&&e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose),"e2"===d?e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose):e.jgrid.info_dialog(e.jgrid.errors.errcap,d.message,e.jgrid.edit.bClose)}}if(f=e.jgrid.checkValues.call(v,m[c],i),f[0]===!1)return f[1]=m[c]+" "+f[1],!1;v.p.autoencode&&(m[c]=e.jgrid.htmlEncode(m[c])),"clientArray"!==l.url&&b.editoptions&&b.editoptions.NullIfEmpty===!0&&""===m[c]&&(h[c]="null")}}),f[0]===!1){try{var x=v.rows.namedItem(i),q=e.jgrid.findPos(x);e.jgrid.info_dialog(e.jgrid.errors.errcap,f[1],e.jgrid.edit.bClose,{left:q[0],top:q[1]+e(x).outerHeight()})}catch(R){alert(f[1])}return g}var y,_=v.p.prmNames,D=i;if(y=v.p.keyIndex===!1?_.id:v.p.colModel[v.p.keyIndex+(v.p.rownumbers===!0?1:0)+(v.p.multiselect===!0?1:0)+(v.p.subGrid===!0?1:0)].name,m){if(m[_.oper]=_.editoper,void 0===m[y]||""===m[y])m[y]=i;else if(j.id!==v.p.idPrefix+m[y]){var I=e.jgrid.stripPref(v.p.idPrefix,i);if(void 0!==v.p._index[I]&&(v.p._index[m[y]]=v.p._index[I],delete v.p._index[I]),i=v.p.idPrefix+m[y],e(j).attr("id",i),v.p.selrow===D&&(v.p.selrow=i),e.isArray(v.p.selarrrow)){var G=e.inArray(D,v.p.selarrrow);G>=0&&(v.p.selarrrow[G]=i)}if(v.p.multiselect){var C="jqg_"+v.p.id+"_"+i;e("input.cbox",j).attr("id",C).attr("name",C)}}void 0===v.p.inlineData&&(v.p.inlineData={}),m=e.extend({},m,v.p.inlineData,l.extraparam)}if("clientArray"===l.url){m=e.extend({},m,w),v.p.autoencode&&e.each(m,function(i,t){m[i]=e.jgrid.htmlDecode(t)});var P,k=e(v).jqGrid("setRowData",i,m);for(e(j).attr("editable","0"),P=0;P<v.p.savedRow.length;P++)if(String(v.p.savedRow[P].id)===String(D)){p=P;break}p>=0&&v.p.savedRow.splice(p,1),e(v).triggerHandler("jqGridInlineAfterSaveRow",[i,k,m,l]),e.isFunction(l.aftersavefunc)&&l.aftersavefunc.call(v,i,k,l),g=!0,e(j).removeClass("jqgrid-new-row").unbind("keydown")}else e("#lui_"+e.jgrid.jqID(v.p.id)).show(),h=e.extend({},m,h),h[y]=e.jgrid.stripPref(v.p.idPrefix,h[y]),e.ajax(e.extend({url:l.url,data:e.isFunction(v.p.serializeRowData)?v.p.serializeRowData.call(v,h):h,type:l.mtype,async:!1,complete:function(t,r){if(e("#lui_"+e.jgrid.jqID(v.p.id)).hide(),"success"===r){var a,d,n=!0;if(a=e(v).triggerHandler("jqGridInlineSuccessSaveRow",[t,i,l]),e.isArray(a)||(a=[!0,m]),a[0]&&e.isFunction(l.successfunc)&&(a=l.successfunc.call(v,t)),e.isArray(a)?(n=a[0],m=a[1]||m):n=a,n===!0){for(v.p.autoencode&&e.each(m,function(i,t){m[i]=e.jgrid.htmlDecode(t)}),m=e.extend({},m,w),e(v).jqGrid("setRowData",i,m),e(j).attr("editable","0"),d=0;d<v.p.savedRow.length;d++)if(String(v.p.savedRow[d].id)===String(i)){p=d;break}p>=0&&v.p.savedRow.splice(p,1),e(v).triggerHandler("jqGridInlineAfterSaveRow",[i,t,m,l]),e.isFunction(l.aftersavefunc)&&l.aftersavefunc.call(v,i,t),g=!0,e(j).removeClass("jqgrid-new-row").unbind("keydown")}else e(v).triggerHandler("jqGridInlineErrorSaveRow",[i,t,r,null,l]),e.isFunction(l.errorfunc)&&l.errorfunc.call(v,i,t,r,null),l.restoreAfterError===!0&&e(v).jqGrid("restoreRow",i,l.afterrestorefunc)}},error:function(t,r,a){if(e("#lui_"+e.jgrid.jqID(v.p.id)).hide(),e(v).triggerHandler("jqGridInlineErrorSaveRow",[i,t,r,a,l]),e.isFunction(l.errorfunc))l.errorfunc.call(v,i,t,r,a);else{var d=t.responseText||t.statusText;try{e.jgrid.info_dialog(e.jgrid.errors.errcap,'<div class="ui-state-error">'+d+"</div>",e.jgrid.edit.bClose,{buttonalign:"right"})}catch(n){alert(d)}}l.restoreAfterError===!0&&e(v).jqGrid("restoreRow",i,l.afterrestorefunc)}},e.jgrid.ajaxOptions,v.p.ajaxRowOptions||{}))}return g},restoreRow:function(i,t){var r=e.makeArray(arguments).slice(1),a={};return"object"===e.type(r[0])?a=r[0]:e.isFunction(t)&&(a.afterrestorefunc=t),a=e.extend(!0,{},e.jgrid.inlineEdit,a),this.each(function(){var t,r,d,n=this,o={};if(n.grid&&(r=e(n).jqGrid("getInd",i,!0),r!==!1)){for(d=0;d<n.p.savedRow.length;d++)if(String(n.p.savedRow[d].id)===String(i)){t=d;break}if(t>=0){if(e.isFunction(e.fn.datepicker))try{e("input.hasDatepicker","#"+e.jgrid.jqID(r.id)).datepicker("hide")}catch(s){}e.each(n.p.colModel,function(){this.editable===!0&&n.p.savedRow[t].hasOwnProperty(this.name)&&(o[this.name]=n.p.savedRow[t][this.name])}),e(n).jqGrid("setRowData",i,o),e(r).attr("editable","0").unbind("keydown"),n.p.savedRow.splice(t,1),e("#"+e.jgrid.jqID(i),"#"+e.jgrid.jqID(n.p.id)).hasClass("jqgrid-new-row")&&setTimeout(function(){e(n).jqGrid("delRowData",i),e(n).jqGrid("showAddEditButtons")},0)}e(n).triggerHandler("jqGridInlineAfterRestoreRow",[i]),e.isFunction(a.afterrestorefunc)&&a.afterrestorefunc.call(n,i)}})},addRow:function(i){return i=e.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,addRowParams:{extraparam:{}}},i||{}),this.each(function(){if(this.grid){var t=this;if(i.rowID=e.isFunction(i.rowID)?i.rowID.call(t,i):null!=i.rowID?i.rowID:e.jgrid.randId(),i.useDefValues===!0&&e(t.p.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var r=this.editoptions.defaultValue,a=e.isFunction(r)?r.call(t):r;i.initdata[this.name]=a}}),e(t).jqGrid("addRowData",i.rowID,i.initdata,i.position),i.rowID=t.p.idPrefix+i.rowID,e("#"+e.jgrid.jqID(i.rowID),"#"+e.jgrid.jqID(t.p.id)).addClass("jqgrid-new-row"),i.useFormatter)e("#"+e.jgrid.jqID(i.rowID)+" .ui-inline-edit","#"+e.jgrid.jqID(t.p.id)).click();else{var r=t.p.prmNames,a=r.oper;i.addRowParams.extraparam[a]=r.addoper,e(t).jqGrid("editRow",i.rowID,i.addRowParams),e(t).jqGrid("setSelection",i.rowID)}}})},inlineNav:function(i,t){return t=e.extend(!0,{edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0},e.jgrid.nav,t||{}),this.each(function(){if(this.grid){var r,a=this,d=e.jgrid.jqID(a.p.id);if(a.p._inlinenav=!0,t.addParams.useFormatter===!0){var n,o=a.p.colModel;for(n=0;n<o.length;n++)if(o[n].formatter&&"actions"===o[n].formatter){if(o[n].formatoptions){var s={keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},l=e.extend(s,o[n].formatoptions);t.addParams.addRowParams={keys:l.keys,oneditfunc:l.onEdit,successfunc:l.onSuccess,url:l.url,extraparam:l.extraparam,aftersavefunc:l.afterSave,errorfunc:l.onError,afterrestorefunc:l.afterRestore}}break}}t.add&&e(a).jqGrid("navButtonAdd",i,{caption:t.addtext,title:t.addtitle,buttonicon:t.addicon,id:a.p.id+"_iladd",onClickButton:function(){e(a).jqGrid("addRow",t.addParams),t.addParams.useFormatter||(e("#"+d+"_ilsave").removeClass("ui-state-disabled"),e("#"+d+"_ilcancel").removeClass("ui-state-disabled"),e("#"+d+"_iladd").addClass("ui-state-disabled"),e("#"+d+"_iledit").addClass("ui-state-disabled"))}}),t.edit&&e(a).jqGrid("navButtonAdd",i,{caption:t.edittext,title:t.edittitle,buttonicon:t.editicon,id:a.p.id+"_iledit",onClickButton:function(){var i=e(a).jqGrid("getGridParam","selrow");i?(e(a).jqGrid("editRow",i,t.editParams),e("#"+d+"_ilsave").removeClass("ui-state-disabled"),e("#"+d+"_ilcancel").removeClass("ui-state-disabled"),e("#"+d+"_iladd").addClass("ui-state-disabled"),e("#"+d+"_iledit").addClass("ui-state-disabled")):(e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+d,jqm:!0}),e("#jqg_alrt").focus())}}),t.save&&(e(a).jqGrid("navButtonAdd",i,{caption:t.savetext||"",title:t.savetitle||"Save row",buttonicon:t.saveicon,id:a.p.id+"_ilsave",onClickButton:function(){var i=a.p.savedRow[0].id;if(i){var r=a.p.prmNames,n=r.oper,o={};e("#"+e.jgrid.jqID(i),"#"+d).hasClass("jqgrid-new-row")?(t.addParams.addRowParams.extraparam[n]=r.addoper,o=t.addParams.addRowParams):(t.editParams.extraparam||(t.editParams.extraparam={}),t.editParams.extraparam[n]=r.editoper,o=t.editParams),e(a).jqGrid("saveRow",i,o)&&e(a).jqGrid("showAddEditButtons")}else e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+d,jqm:!0}),e("#jqg_alrt").focus()}}),e("#"+d+"_ilsave").addClass("ui-state-disabled")),t.cancel&&(e(a).jqGrid("navButtonAdd",i,{caption:t.canceltext||"",title:t.canceltitle||"Cancel row editing",buttonicon:t.cancelicon,id:a.p.id+"_ilcancel",onClickButton:function(){var i=a.p.savedRow[0].id,r={};i?(r=e("#"+e.jgrid.jqID(i),"#"+d).hasClass("jqgrid-new-row")?t.addParams.addRowParams:t.editParams,e(a).jqGrid("restoreRow",i,r),e(a).jqGrid("showAddEditButtons")):(e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+d,jqm:!0}),e("#jqg_alrt").focus())}}),e("#"+d+"_ilcancel").addClass("ui-state-disabled")),t.restoreAfterSelect===!0&&(r=e.isFunction(a.p.beforeSelectRow)?a.p.beforeSelectRow:!1,a.p.beforeSelectRow=function(i,d){var n=!0;return a.p.savedRow.length>0&&a.p._inlinenav===!0&&i!==a.p.selrow&&null!==a.p.selrow&&(a.p.selrow===t.addParams.rowID?e(a).jqGrid("delRowData",a.p.selrow):e(a).jqGrid("restoreRow",a.p.selrow,t.editParams),e(a).jqGrid("showAddEditButtons")),r&&(n=r.call(a,i,d)),n})}})},showAddEditButtons:function(){return this.each(function(){if(this.grid){var i=e.jgrid.jqID(this.p.id);e("#"+i+"_ilsave").addClass("ui-state-disabled"),e("#"+i+"_ilcancel").addClass("ui-state-disabled"),e("#"+i+"_iladd").removeClass("ui-state-disabled"),e("#"+i+"_iledit").removeClass("ui-state-disabled")}})}})}(jQuery);