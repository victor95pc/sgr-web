!function(e){"use strict";e.extend(e.jgrid,{showModal:function(e){e.w.show()},closeModal:function(e){e.w.hide().attr("aria-hidden","true"),e.o&&e.o.remove()},hideModal:function(t,i){if(i=e.extend({jqm:!0,gb:""},i||{}),i.onClose){var a=i.gb&&"string"==typeof i.gb&&"#gbox_"===i.gb.substr(0,6)?i.onClose.call(e("#"+i.gb.substr(6))[0],t):i.onClose(t);if("boolean"==typeof a&&!a)return}if(e.fn.jqm&&i.jqm===!0)e(t).attr("aria-hidden","true").jqmHide();else{if(""!==i.gb)try{e(".jqgrid-overlay:first",i.gb).hide()}catch(r){}e(t).hide().attr("aria-hidden","true")}},findPos:function(e){var t=0,i=0;if(e.offsetParent)do t+=e.offsetLeft,i+=e.offsetTop;while(e=e.offsetParent);return[t,i]},createModal:function(t,i,a,r,o,n,d){a=e.extend(!0,{},e.jgrid.jqModal||{},a);var l,s=document.createElement("div"),u=this;d=e.extend({},d||{}),l="rtl"===e(a.gbox).attr("dir")?!0:!1,s.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog",s.id=t.themodal;var c=document.createElement("div");c.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix",c.id=t.modalhead,e(c).append("<span class='ui-jqdialog-title'>"+a.caption+"</span>");var f=e("<a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){f.addClass("ui-state-hover")},function(){f.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-closethick'></span>");e(c).append(f),l?(s.dir="rtl",e(".ui-jqdialog-title",c).css("float","right"),e(".ui-jqdialog-titlebar-close",c).css("left","0.3em")):(s.dir="ltr",e(".ui-jqdialog-title",c).css("float","left"),e(".ui-jqdialog-titlebar-close",c).css("right","0.3em"));var m=document.createElement("div");e(m).addClass("ui-jqdialog-content ui-widget-content").attr("id",t.modalcontent),e(m).append(i),s.appendChild(m),e(s).prepend(c),n===!0?e("body").append(s):"string"==typeof n?e(n).append(s):e(s).insertBefore(r),e(s).css(d),void 0===a.jqModal&&(a.jqModal=!0);var g={};if(e.fn.jqm&&a.jqModal===!0){if(0===a.left&&0===a.top&&a.overlay){var h=[];h=e.jgrid.findPos(o),a.left=h[0]+4,a.top=h[1]+4}g.top=a.top+"px",g.left=a.left}else(0!==a.left||0!==a.top)&&(g.left=a.left,g.top=a.top+"px");if(e("a.ui-jqdialog-titlebar-close",c).click(function(){var i=e("#"+e.jgrid.jqID(t.themodal)).data("onClose")||a.onClose,r=e("#"+e.jgrid.jqID(t.themodal)).data("gbox")||a.gbox;return u.hideModal("#"+e.jgrid.jqID(t.themodal),{gb:r,jqm:a.jqModal,onClose:i}),!1}),0!==a.width&&a.width||(a.width=300),0!==a.height&&a.height||(a.height=200),!a.zIndex){var p=e(r).parents("*[role=dialog]").filter(":first").css("z-index");a.zIndex=p?parseInt(p,10)+2:950}var F=0;if(l&&g.left&&!n&&(F=e(a.gbox).width()-(isNaN(a.width)?0:parseInt(a.width,10))-8,g.left=parseInt(g.left,10)+parseInt(F,10)),g.left&&(g.left+="px"),e(s).css(e.extend({width:isNaN(a.width)?"auto":a.width+"px",height:isNaN(a.height)?"auto":a.height+"px",zIndex:a.zIndex,overflow:"hidden"},g)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":t.modalhead,"aria-hidden":"true"}),void 0===a.drag&&(a.drag=!0),void 0===a.resize&&(a.resize=!0),a.drag)if(e(c).css("cursor","move"),e.fn.jqDrag)e(s).jqDrag(c);else try{e(s).draggable({handle:e("#"+e.jgrid.jqID(c.id))})}catch(v){}if(a.resize)if(e.fn.jqResize)e(s).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se'></div>"),e("#"+e.jgrid.jqID(t.themodal)).jqResize(".jqResize",t.scrollelm?"#"+e.jgrid.jqID(t.scrollelm):!1);else try{e(s).resizable({handles:"se, sw",alsoResize:t.scrollelm?"#"+e.jgrid.jqID(t.scrollelm):!1})}catch(j){}a.closeOnEscape===!0&&e(s).keydown(function(i){if(27==i.which){var r=e("#"+e.jgrid.jqID(t.themodal)).data("onClose")||a.onClose;u.hideModal("#"+e.jgrid.jqID(t.themodal),{gb:a.gbox,jqm:a.jqModal,onClose:r})}})},viewModal:function(t,i){if(i=e.extend({toTop:!0,overlay:10,modal:!1,overlayClass:"ui-widget-overlay",onShow:e.jgrid.showModal,onHide:e.jgrid.closeModal,gbox:"",jqm:!0,jqM:!0},i||{}),e.fn.jqm&&i.jqm===!0)i.jqM?e(t).attr("aria-hidden","false").jqm(i).jqmShow():e(t).attr("aria-hidden","false").jqmShow();else{""!==i.gbox&&(e(".jqgrid-overlay:first",i.gbox).show(),e(t).data("gbox",i.gbox)),e(t).show().attr("aria-hidden","false");try{e(":input:visible",t)[0].focus()}catch(a){}}},info_dialog:function(t,i,a,r){var o={width:290,height:"auto",dataheight:"auto",drag:!0,resize:!1,left:250,top:170,zIndex:1e3,jqModal:!0,modal:!1,closeOnEscape:!0,align:"center",buttonalign:"center",buttons:[]};e.extend(!0,o,e.jgrid.jqModal||{},{caption:"<b>"+t+"</b>"},r||{});var n=o.jqModal,d=this;e.fn.jqm&&!n&&(n=!1);var l,s="";if(o.buttons.length>0)for(l=0;l<o.buttons.length;l++)void 0===o.buttons[l].id&&(o.buttons[l].id="info_button_"+l),s+="<a href='javascript:void(0)' id='"+o.buttons[l].id+"' class='fm-button ui-state-default ui-corner-all'>"+o.buttons[l].text+"</a>";var u=isNaN(o.dataheight)?o.dataheight:o.dataheight+"px",c="text-align:"+o.align+";",f="<div id='info_id'>";f+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+u+";"+c+"'>"+i+"</div>",f+=a?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+o.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+a+"</a>"+s+"</div>":""!==s?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+o.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+s+"</div>":"",f+="</div>";try{"false"===e("#info_dialog").attr("aria-hidden")&&e.jgrid.hideModal("#info_dialog",{jqm:n}),e("#info_dialog").remove()}catch(m){}e.jgrid.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},f,o,"","",!0),s&&e.each(o.buttons,function(t){e("#"+e.jgrid.jqID(this.id),"#info_id").bind("click",function(){return o.buttons[t].onClick.call(e("#info_dialog")),!1})}),e("#closedialog","#info_id").click(function(){return d.hideModal("#info_dialog",{jqm:n,onClose:e("#info_dialog").data("onClose")||o.onClose,gb:e("#info_dialog").data("gbox")||o.gbox}),!1}),e(".fm-button","#info_dialog").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}),e.isFunction(o.beforeOpen)&&o.beforeOpen(),e.jgrid.viewModal("#info_dialog",{onHide:function(e){e.w.hide().remove(),e.o&&e.o.remove()},modal:o.modal,jqm:n}),e.isFunction(o.afterOpen)&&o.afterOpen();try{e("#info_dialog").focus()}catch(g){}},bindEv:function(t,i){var a=this;e.isFunction(i.dataInit)&&i.dataInit.call(a,t),i.dataEvents&&e.each(i.dataEvents,function(){void 0!==this.data?e(t).bind(this.type,this.data,this.fn):e(t).bind(this.type,this.fn)})},createEl:function(t,i,a,r,o){function n(t,i,a){var r=["dataInit","dataEvents","dataUrl","buildSelect","sopt","searchhidden","defaultValue","attr","custom_element","custom_value"];void 0!==a&&e.isArray(a)&&e.merge(r,a),e.each(i,function(i,a){-1===e.inArray(i,r)&&e(t).attr(i,a)}),i.hasOwnProperty("id")||e(t).attr("id",e.jgrid.randId())}var d="",l=this;switch(t){case"textarea":d=document.createElement("textarea"),r?i.cols||e(d).css({width:"98%"}):i.cols||(i.cols=20),i.rows||(i.rows=2),("&nbsp;"===a||"&#160;"===a||1===a.length&&160===a.charCodeAt(0))&&(a=""),d.value=a,n(d,i),e(d).attr({role:"textbox",multiline:"true"});break;case"checkbox":if(d=document.createElement("input"),d.type="checkbox",i.value){var s=i.value.split(":");a===s[0]&&(d.checked=!0,d.defaultChecked=!0),d.value=s[0],e(d).attr("offval",s[1])}else{var u=a.toLowerCase();u.search(/(false|f|0|no|n|off|undefined)/i)<0&&""!==u?(d.checked=!0,d.defaultChecked=!0,d.value=a):d.value="on",e(d).attr("offval","off")}n(d,i,["value"]),e(d).attr("role","checkbox");break;case"select":d=document.createElement("select"),d.setAttribute("role","select");var c,f=[];if(i.multiple===!0?(c=!0,d.multiple="multiple",e(d).attr("aria-multiselectable","true")):c=!1,void 0!==i.dataUrl){var m=i.name?String(i.id).substring(0,String(i.id).length-String(i.name).length-1):String(i.id),g=i.postData||o.postData;l.p&&l.p.idPrefix?m=e.jgrid.stripPref(l.p.idPrefix,m):g=void 0,e.ajax(e.extend({url:i.dataUrl,type:"GET",dataType:"html",data:e.isFunction(g)?g.call(l,m,a,String(i.name)):g,context:{elem:d,options:i,vl:a},success:function(t){var i=[],a=this.elem,r=this.vl,o=e.extend({},this.options),d=o.multiple===!0,s=e.isFunction(o.buildSelect)?o.buildSelect.call(l,t):t;"string"==typeof s&&(s=e(e.trim(s)).html()),s&&(e(a).append(s),n(a,o),void 0===o.size&&(o.size=d?3:1),d?(i=r.split(","),i=e.map(i,function(t){return e.trim(t)})):i[0]=e.trim(r),setTimeout(function(){e("option",a).each(function(t){0===t&&a.multiple&&(this.selected=!1),e(this).attr("role","option"),(e.inArray(e.trim(e(this).text()),i)>-1||e.inArray(e.trim(e(this).val()),i)>-1)&&(this.selected="selected")})},0))}},o||{}))}else if(i.value){var h;void 0===i.size&&(i.size=c?3:1),c&&(f=a.split(","),f=e.map(f,function(t){return e.trim(t)})),"function"==typeof i.value&&(i.value=i.value());var p,F,v,j=void 0===i.separator?":":i.separator,b=void 0===i.delimiter?";":i.delimiter;if("string"==typeof i.value)for(p=i.value.split(b),h=0;h<p.length;h++)F=p[h].split(j),F.length>2&&(F[1]=e.map(F,function(e,t){return t>0?e:void 0}).join(j)),v=document.createElement("option"),v.setAttribute("role","option"),v.value=F[0],v.innerHTML=F[1],d.appendChild(v),c||e.trim(F[0])!==e.trim(a)&&e.trim(F[1])!==e.trim(a)||(v.selected="selected"),c&&(e.inArray(e.trim(F[1]),f)>-1||e.inArray(e.trim(F[0]),f)>-1)&&(v.selected="selected");else if("object"==typeof i.value){var x,y=i.value;for(x in y)y.hasOwnProperty(x)&&(v=document.createElement("option"),v.setAttribute("role","option"),v.value=x,v.innerHTML=y[x],d.appendChild(v),c||e.trim(x)!==e.trim(a)&&e.trim(y[x])!==e.trim(a)||(v.selected="selected"),c&&(e.inArray(e.trim(y[x]),f)>-1||e.inArray(e.trim(x),f)>-1)&&(v.selected="selected"))}n(d,i,["value"])}break;case"text":case"password":case"button":var w;w="button"===t?"button":"textbox",d=document.createElement("input"),d.type=t,d.value=a,n(d,i),"button"!==t&&(r?i.size||e(d).css({width:"98%"}):i.size||(i.size=20)),e(d).attr("role",w);break;case"image":case"file":d=document.createElement("input"),d.type=t,n(d,i);break;case"custom":d=document.createElement("span");try{if(!e.isFunction(i.custom_element))throw"e1";var q=i.custom_element.call(l,a,i);if(!q)throw"e2";q=e(q).addClass("customelement").attr({id:i.id,name:i.name}),e(d).empty().append(q)}catch(D){"e1"===D&&e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose),"e2"===D?e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose):e.jgrid.info_dialog(e.jgrid.errors.errcap,"string"==typeof D?D:D.message,e.jgrid.edit.bClose)}}return d},checkDate:function(e,t){var i,a=function(e){return e%4!==0||e%100===0&&e%400!==0?28:29},r={};if(e=e.toLowerCase(),i=-1!==e.indexOf("/")?"/":-1!==e.indexOf("-")?"-":-1!==e.indexOf(".")?".":"/",e=e.split(i),t=t.split(i),3!==t.length)return!1;var o,n,d=-1,l=-1,s=-1;for(n=0;n<e.length;n++){var u=isNaN(t[n])?0:parseInt(t[n],10);r[e[n]]=u,o=e[n],-1!==o.indexOf("y")&&(d=n),-1!==o.indexOf("m")&&(s=n),-1!==o.indexOf("d")&&(l=n)}o="y"===e[d]||"yyyy"===e[d]?4:"yy"===e[d]?2:-1;var c,f=[0,31,29,31,30,31,30,31,31,30,31,30,31];return-1===d?!1:(c=r[e[d]].toString(),2===o&&1===c.length&&(o=1),c.length!==o||0===r[e[d]]&&"00"!==t[d]?!1:-1===s?!1:(c=r[e[s]].toString(),c.length<1||r[e[s]]<1||r[e[s]]>12?!1:-1===l?!1:(c=r[e[l]].toString(),c.length<1||r[e[l]]<1||r[e[l]]>31||2===r[e[s]]&&r[e[l]]>a(r[e[d]])||r[e[l]]>f[r[e[s]]]?!1:!0)))},isEmpty:function(e){return e.match(/^\s+$/)||""===e?!0:!1},checkTime:function(t){var i,a=/^(\d{1,2}):(\d{2})([apAP][Mm])?$/;if(!e.jgrid.isEmpty(t)){if(i=t.match(a),!i)return!1;if(i[3]){if(i[1]<1||i[1]>12)return!1}else if(i[1]>23)return!1;if(i[2]>59)return!1}return!0},checkValues:function(t,i,a,r){var o,n,d,l,s,u=this,c=u.p.colModel;if(void 0===a)if("string"==typeof i){for(n=0,s=c.length;s>n;n++)if(c[n].name===i){o=c[n].editrules,i=n,null!=c[n].formoptions&&(d=c[n].formoptions.label);break}}else i>=0&&(o=c[i].editrules);else o=a,d=void 0===r?"_":r;if(o){if(d||(d=null!=u.p.colNames?u.p.colNames[i]:c[i].label),o.required===!0&&e.jgrid.isEmpty(t))return[!1,d+": "+e.jgrid.edit.msg.required,""];var f=o.required===!1?!1:!0;if(o.number===!0&&(f!==!1||!e.jgrid.isEmpty(t))&&isNaN(t))return[!1,d+": "+e.jgrid.edit.msg.number,""];if(void 0!==o.minValue&&!isNaN(o.minValue)&&parseFloat(t)<parseFloat(o.minValue))return[!1,d+": "+e.jgrid.edit.msg.minValue+" "+o.minValue,""];if(void 0!==o.maxValue&&!isNaN(o.maxValue)&&parseFloat(t)>parseFloat(o.maxValue))return[!1,d+": "+e.jgrid.edit.msg.maxValue+" "+o.maxValue,""];var m;if(o.email===!0&&!(f===!1&&e.jgrid.isEmpty(t)||(m=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,m.test(t))))return[!1,d+": "+e.jgrid.edit.msg.email,""];if(o.integer===!0&&(f!==!1||!e.jgrid.isEmpty(t))){if(isNaN(t))return[!1,d+": "+e.jgrid.edit.msg.integer,""];if(t%1!==0||-1!==t.indexOf("."))return[!1,d+": "+e.jgrid.edit.msg.integer,""]}if(o.date===!0&&!(f===!1&&e.jgrid.isEmpty(t)||(c[i].formatoptions&&c[i].formatoptions.newformat?(l=c[i].formatoptions.newformat,e.jgrid.formatter.date.masks.hasOwnProperty(l)&&(l=e.jgrid.formatter.date.masks[l])):l=c[i].datefmt||"Y-m-d",e.jgrid.checkDate(l,t))))return[!1,d+": "+e.jgrid.edit.msg.date+" - "+l,""];if(o.time===!0&&!(f===!1&&e.jgrid.isEmpty(t)||e.jgrid.checkTime(t)))return[!1,d+": "+e.jgrid.edit.msg.date+" - hh:mm (am/pm)",""];if(o.url===!0&&!(f===!1&&e.jgrid.isEmpty(t)||(m=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i,m.test(t))))return[!1,d+": "+e.jgrid.edit.msg.url,""];if(o.custom===!0&&(f!==!1||!e.jgrid.isEmpty(t))){if(e.isFunction(o.custom_func)){var g=o.custom_func.call(u,t,d,i);return e.isArray(g)?g:[!1,e.jgrid.edit.msg.customarray,""]}return[!1,e.jgrid.edit.msg.customfcheck,""]}}return[!0,"",""]}})}(jQuery);