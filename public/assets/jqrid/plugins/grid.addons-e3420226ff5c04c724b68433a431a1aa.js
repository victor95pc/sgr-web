!function(e){e.jgrid.extend({searchGrid:function(t){return t=e.extend({recreateFilter:!1,drag:!0,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:!0,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,closeAfterSearch:!1,closeAfterReset:!1,closeOnEscape:!1,multipleSearch:!1,cloneSearchRowOnAdd:!0,sopt:null,stringResult:void 0,onClose:null,useDataProxy:!1,overlay:!0},e.jgrid.search,t||{}),this.each(function(){function r(t,r){var i=t.p.postData[r.sFilter];if("string"==typeof i&&(i=e.jgrid.parse(i)),i&&(i.groupOp&&t.SearchFilter.setGroupOp(i.groupOp),i.rules))for(var a,s=0,l=i.rules.length,n=!1;l>s;s++)a=i.rules[s],void 0!==a.field&&void 0!==a.op&&void 0!==a.data&&(n=t.SearchFilter.setFilter({sfref:t.SearchFilter.$.find(".sf:last"),filter:e.extend({},a)}),n&&t.SearchFilter.add())}function i(r){if(t.onClose){var i=t.onClose(r);if("boolean"==typeof i&&!i)return}r.hide(),t.overlay===!0&&e(".jqgrid-overlay:first","#gbox_"+n.p.id).hide()}function a(){var r=e(".ui-searchFilter").length;if(r>1){var i=e("#"+d).css("zIndex");e("#"+d).css({zIndex:parseInt(i,10)+r})}e("#"+d).show(),t.overlay===!0&&e(".jqgrid-overlay:first","#gbox_"+n.p.id).show();try{e(":input:visible","#"+d)[0].focus()}catch(a){}}function s(r){var a=void 0!==r,s=e("#"+n.p.id),l={};t.multipleSearch===!1?(l[t.sField]=r.rules[0].field,l[t.sValue]=r.rules[0].data,l[t.sOper]=r.rules[0].op,l.hasOwnProperty(t.sFilter)&&delete l[t.sFilter]):(l[t.sFilter]=r,e.each([t.sField,t.sValue,t.sOper],function(e,t){l.hasOwnProperty(t)&&delete l[t]})),s[0].p.search=a,e.extend(s[0].p.postData,l),s.trigger("reloadGrid",[{page:1}]),t.closeAfterSearch&&i(e("#"+d))}function l(r){var a=r&&r.hasOwnProperty("reload")?r.reload:!0,s=e("#"+n.p.id),l={};s[0].p.search=!1,t.multipleSearch===!1?l[t.sField]=l[t.sValue]=l[t.sOper]="":l[t.sFilter]="",e.extend(s[0].p.postData,l),a&&s.trigger("reloadGrid",[{page:1}]),t.closeAfterReset&&i(e("#"+d))}var n=this;if(n.grid){var d="fbox_"+n.p.id,o=!0;if(e.fn.searchFilter)if(t.recreateFilter===!0&&e("#"+d).remove(),null!==e("#"+d).html()){if(e.isFunction(t.beforeShowSearch)&&(o=t.beforeShowSearch(e("#"+d)),"undefined"==typeof o&&(o=!0)),o===!1)return;a(),e.isFunction(t.afterShowSearch)&&t.afterShowSearch(e("#"+d))}else{var h,p,c,u=[],f=e("#"+n.p.id).jqGrid("getGridParam","colNames"),m=e("#"+n.p.id).jqGrid("getGridParam","colModel"),g=["eq","ne","lt","le","gt","ge","bw","bn","in","ni","ew","en","cn","nc"],v=[];if(null!==t.sopt)for(c=0,h=0;h<t.sopt.length;h++)-1!=(p=e.inArray(t.sopt[h],g))&&(v[c]={op:t.sopt[h],text:t.odata[p]},c++);else for(h=0;h<g.length;h++)v[h]={op:g[h],text:t.odata[h]};if(e.each(m,function(r,i){var a="undefined"==typeof i.search?!0:i.search,s=i.hidden===!0,l=e.extend({},{text:f[r],itemval:i.index||i.name},this.searchoptions),n=l.searchhidden===!0;if("undefined"!=typeof l.sopt&&(c=0,l.ops=[],l.sopt.length>0))for(h=0;h<l.sopt.length;h++)-1!=(p=e.inArray(l.sopt[h],g))&&(l.ops[c]={op:l.sopt[h],text:t.odata[p]},c++);if("undefined"==typeof this.stype&&(this.stype="text"),"select"==this.stype)if(void 0!==l.dataUrl);else{var d;if(l.value?d=l.value:this.editoptions&&(d=this.editoptions.value),d)if(l.dataValues=[],"string"==typeof d){var o,m=d.split(";");for(h=0;h<m.length;h++)o=m[h].split(":"),l.dataValues[h]={value:o[0],text:o[1]}}else if("object"==typeof d){h=0;for(var v in d)d.hasOwnProperty(v)&&(l.dataValues[h]={value:v,text:d[v]},h++)}}(n&&a||a&&!s)&&u.push(l)}),u.length>0){if(e("<div id='"+d+"' role='dialog' tabindex='-1'></div>").insertBefore("#gview_"+n.p.id),void 0===t.stringResult&&(t.stringResult=t.multipleSearch),n.SearchFilter=e("#"+d).searchFilter(u,{groupOps:t.groupOps,operators:v,onClose:i,resetText:t.Reset,searchText:t.Find,windowTitle:t.caption,rulesText:t.rulesText,matchText:t.matchText,onSearch:s,onReset:l,stringResult:t.stringResult,ajaxSelectOptions:e.extend({},e.jgrid.ajaxOptions,n.p.ajaxSelectOptions||{}),clone:t.cloneSearchRowOnAdd}),e(".ui-widget-overlay","#"+d).remove(),"rtl"==n.p.direction&&e(".ui-closer","#"+d).css("float","left"),t.drag===!0)if(e("#"+d+" table thead tr:first td:first").css("cursor","move"),jQuery.fn.jqDrag)e("#"+d).jqDrag(e("#"+d+" table thead tr:first td:first"));else try{e("#"+d).draggable({handle:e("#"+d+" table thead tr:first td:first")})}catch(y){}if(t.multipleSearch===!1&&(e(".ui-del, .ui-add, .ui-del, .ui-add-last, .matchText, .rulesText","#"+d).hide(),e("select[name='groupOp']","#"+d).hide()),t.multipleSearch===!0&&t.loadDefaults===!0&&r(n,t),e.isFunction(t.onInitializeSearch)&&t.onInitializeSearch(e("#"+d)),e.isFunction(t.beforeShowSearch)&&(o=t.beforeShowSearch(e("#"+d)),"undefined"==typeof o&&(o=!0)),o===!1)return;a(),e.isFunction(t.afterShowSearch)&&t.afterShowSearch(e("#"+d)),t.closeOnEscape===!0&&e("#"+d).keydown(function(t){27==t.which&&i(e("#"+d)),13==t.which&&e(".ui-search",this).click()})}}}})},updateGridRows:function(t,r,i){var a,s,l=!1;return this.each(function(){var n,d,o,h,p=this;return p.grid?(r||(r="id"),t&&t.length>0&&e(t).each(function(){if(o=this,d=p.rows.namedItem(o[r])){if(h=o[r],i===!0&&p.p.jsonReader.repeatitems===!0){p.p.jsonReader.cell&&(o=o[p.p.jsonReader.cell]);for(var t=0;t<o.length;t++)n=p.formatter(h,o[t],t,o,"edit"),s=p.p.colModel[t].title?{title:e.jgrid.stripHtml(n)}:{},p.p.treeGrid===!0&&a==p.p.ExpandColumn?e("td:eq("+t+") > span:first",d).html(n).attr(s):e("td:eq("+t+")",d).html(n).attr(s);return l=!0,!0}e(p.p.colModel).each(function(t){a=i===!0?this.jsonmap||this.name:this.name,void 0!==o[a]&&(n=p.formatter(h,o[a],t,o,"edit"),s=this.title?{title:e.jgrid.stripHtml(n)}:{},p.p.treeGrid===!0&&a==p.p.ExpandColumn?e("td:eq("+t+") > span:first",d).html(n).attr(s):e("td:eq("+t+")",d).html(n).attr(s),l=!0)})}}),void 0):!1}),l},filterGrid:function(t,r){return r=e.extend({gridModel:!1,gridNames:!1,gridToolbar:!1,filterModel:[],formtype:"horizontal",autosearch:!0,formclass:"filterform",tableclass:"filtertable",buttonclass:"filterbutton",searchButton:"Search",clearButton:"Clear",enableSearch:!1,enableClear:!1,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,url:"",marksearched:!0},r||{}),this.each(function(){var i=this;if(this.p=r,0===this.p.filterModel.length&&this.p.gridModel===!1)return alert("No filter is set"),void 0;if(!t)return alert("No target grid is set!"),void 0;this.p.gridid=-1!=t.indexOf("#")?t:"#"+t;var a=e(this.p.gridid).jqGrid("getGridParam","colModel");if(!a)return alert("Could not get grid colModel"),void 0;if(this.p.gridModel===!0){var s,l=e(this.p.gridid)[0];e.each(a,function(e){var t=[];this.search=this.search===!1?!1:!0,s=this.editrules&&this.editrules.searchhidden===!0?!0:this.hidden===!0?!1:!0,this.search===!0&&s===!0&&(t.label=i.p.gridNames===!0?l.p.colNames[e]:"",t.name=this.name,t.index=this.index||this.name,t.stype=this.edittype||"text","select"!=t.stype&&(t.stype="text"),t.defval=this.defval||"",t.surl=this.surl||"",t.sopt=this.editoptions||{},t.width=this.width,i.p.filterModel.push(t))})}else e.each(i.p.filterModel,function(){for(var e=0;e<a.length;e++)if(this.name==a[e].name){this.index=a[e].index||this.name;break}this.index||(this.index=this.name)});var n,d=function(){var t,r,a={},s=0,l=e(i.p.gridid)[0];l.p.searchdata={},e.isFunction(i.p.beforeSearch)&&i.p.beforeSearch(),e.each(i.p.filterModel,function(){if(r=this.index,"select"===this.stype)if(t=e("select[name="+r+"]",i).val())a[r]=t,i.p.marksearched&&e("#jqgh_"+this.name,l.grid.hDiv).addClass("dirty-cell"),s++;else{i.p.marksearched&&e("#jqgh_"+this.name,l.grid.hDiv).removeClass("dirty-cell");try{delete l.p.postData[this.index]}catch(n){}}else if(t=e("input[name="+r+"]",i).val())a[r]=t,i.p.marksearched&&e("#jqgh_"+this.name,l.grid.hDiv).addClass("dirty-cell"),s++;else{i.p.marksearched&&e("#jqgh_"+this.name,l.grid.hDiv).removeClass("dirty-cell");try{delete l.p.postData[this.index]}catch(d){}}});var n=s>0?!0:!1;e.extend(l.p.postData,a);var d;i.p.url&&(d=e(l).jqGrid("getGridParam","url"),e(l).jqGrid("setGridParam",{url:i.p.url})),e(l).jqGrid("setGridParam",{search:n}).trigger("reloadGrid",[{page:1}]),d&&e(l).jqGrid("setGridParam",{url:d}),e.isFunction(i.p.afterSearch)&&i.p.afterSearch()},o=function(){var t,r,a={},s=0,l=e(i.p.gridid)[0];e.isFunction(i.p.beforeClear)&&i.p.beforeClear(),e.each(i.p.filterModel,function(){switch(r=this.index,t=this.defval?this.defval:"",this.stype||(this.stype="text"),this.stype){case"select":var n;if(e("select[name="+r+"] option",i).each(function(r){return 0===r&&(this.selected=!0),e(this).text()==t?(this.selected=!0,n=e(this).val(),!1):void 0}),n)a[r]=n,i.p.marksearched&&e("#jqgh_"+this.name,l.grid.hDiv).addClass("dirty-cell"),s++;else{i.p.marksearched&&e("#jqgh_"+this.name,l.grid.hDiv).removeClass("dirty-cell");try{delete l.p.postData[this.index]}catch(d){}}break;case"text":if(e("input[name="+r+"]",i).val(t),t)a[r]=t,i.p.marksearched&&e("#jqgh_"+this.name,l.grid.hDiv).addClass("dirty-cell"),s++;else{i.p.marksearched&&e("#jqgh_"+this.name,l.grid.hDiv).removeClass("dirty-cell");try{delete l.p.postData[this.index]}catch(o){}}}});var n=s>0?!0:!1;e.extend(l.p.postData,a);var d;i.p.url&&(d=e(l).jqGrid("getGridParam","url"),e(l).jqGrid("setGridParam",{url:i.p.url})),e(l).jqGrid("setGridParam",{search:n}).trigger("reloadGrid",[{page:1}]),d&&e(l).jqGrid("setGridParam",{url:d}),e.isFunction(i.p.afterClear)&&i.p.afterClear()},h=function(){var t,r,a,s,l,h=document.createElement("tr");"horizontal"==i.p.formtype&&e(n).append(h),e.each(i.p.filterModel,function(r){s=document.createElement("td"),e(s).append("<label for='"+this.name+"'>"+this.label+"</label>"),l=document.createElement("td");var a=this;switch(this.stype||(this.stype="text"),this.stype){case"select":if(this.surl)e(l).load(this.surl,function(){a.defval&&e("select",this).val(a.defval),e("select",this).attr({name:a.index||a.name,id:"sg_"+a.name}),a.sopt&&e("select",this).attr(a.sopt),i.p.gridToolbar===!0&&a.width&&e("select",this).width(a.width),i.p.autosearch===!0&&e("select",this).change(function(){return d(),!1})});else if(a.sopt.value){var o=a.sopt.value,p=document.createElement("select");e(p).attr({name:a.index||a.name,id:"sg_"+a.name}).attr(a.sopt);var c,u,f;if("string"==typeof o){c=o.split(";");for(var m=0;m<c.length;m++)u=c[m].split(":"),f=document.createElement("option"),f.value=u[0],f.innerHTML=u[1],u[1]==a.defval&&(f.selected="selected"),p.appendChild(f)}else if("object"==typeof o)for(var g in o)o.hasOwnProperty(g)&&(r++,f=document.createElement("option"),f.value=g,f.innerHTML=o[g],o[g]==a.defval&&(f.selected="selected"),p.appendChild(f));i.p.gridToolbar===!0&&a.width&&e(p).width(a.width),e(l).append(p),i.p.autosearch===!0&&e(p).change(function(){return d(),!1})}break;case"text":var v=this.defval?this.defval:"";e(l).append("<input type='text' name='"+(this.index||this.name)+"' id='sg_"+this.name+"' value='"+v+"'/>"),a.sopt&&e("input",l).attr(a.sopt),i.p.gridToolbar===!0&&a.width&&(e.browser.msie?e("input",l).width(a.width-4):e("input",l).width(a.width-2)),i.p.autosearch===!0&&e("input",l).keypress(function(e){var t=e.charCode?e.charCode:e.keyCode?e.keyCode:0;return 13==t?(d(),!1):this})}"horizontal"==i.p.formtype?(i.p.gridToolbar===!0&&i.p.gridNames===!1?e(h).append(l):e(h).append(s).append(l),e(h).append(l)):(t=document.createElement("tr"),e(t).append(s).append(l),e(n).append(t))}),l=document.createElement("td"),i.p.enableSearch===!0&&(r="<input type='button' id='sButton' class='"+i.p.buttonclass+"' value='"+i.p.searchButton+"'/>",e(l).append(r),e("input#sButton",l).click(function(){return d(),!1})),i.p.enableClear===!0&&(a="<input type='button' id='cButton' class='"+i.p.buttonclass+"' value='"+i.p.clearButton+"'/>",e(l).append(a),e("input#cButton",l).click(function(){return o(),!1})),(i.p.enableClear===!0||i.p.enableSearch===!0)&&("horizontal"==i.p.formtype?e(h).append(l):(t=document.createElement("tr"),e(t).append("<td>&#160;</td>").append(l),e(n).append(t)))},p=e("<form name='SearchForm' style=display:inline;' class='"+this.p.formclass+"'></form>");n=e("<table class='"+this.p.tableclass+"' cellspacing='0' cellpading='0' border='0'><tbody></tbody></table>"),e(p).append(n),h(),e(this).append(p),this.triggerSearch=d,this.clearSearch=o})}})}(jQuery);